name: Jellyfin yt-dlp
run-name: Build container
on: [push]
envs:
  - DOCKER_USERNAME = maxvdm
  - DOCKER_PASSWORD = MRw8BTsyhGCqy;cw
  - DOCKER_USERNAME_GITEA = max
  - DOCKER_PASSWORD_GITEA = H3[N^mDqFUV[9zCu
  - DOCKER_REGISTRY_GITEA - https://gitea.svdm.me

jobs:
  Build-container:
    runs-on: ubuntu-latest
    steps:
      - name: Install docker
        run: curl -fsSL https://get.docker.com -o get-docker.sh
        run: sh get-docker.sh
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Build container
        run: docker build --pull -t "gitea.svdm.me/max/jellyfin-ytdlp:latest" .
        
  deploy-container:
    runs-on: ubuntu-latest
    steps:
      - name: Install docker
        run: curl -fsSL https://get.docker.com -o get-docker.sh
        run: sh get-docker.sh
      - name: Login to docker registry
        run: docker login -u "DOCKER_USERNAME_GITEA" -p "DOCKER_PASSWORD_GITEA" DOCKER_REGISTRY_GITEA
      - name: Push container to registry
        run: docker push gitea.svdm.me/max/jellyfin-ytdlp:latest